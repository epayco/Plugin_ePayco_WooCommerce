/* jshint es3: false */
/* globals wc_epayco_daviplata_checkout_params, CheckoutDaviplataElements, CheckoutDaviplataPage */
(function ($) {
    'use strict';

    $(function () {
        var epayco_submit_daviplata = false;

        // Handler form submit
        function epaycoFormHandlerDaviplata() {
            if (!document.getElementById('payment_method_woo-epayco-daviplata').checked) {
                return true;
            }
            let daviplataContent = document.querySelector("form.checkout").getElementsByClassName("ep-checkout-daviplata-content")[0];
            //let daviplataContent = document.querySelector(CheckoutDaviplataElements.daviplataContent);
            let daviplataHelpers = daviplataContent.querySelectorAll('input-helper');
            
            verifyName(daviplataContent)
            verifyEmail(daviplataContent)
            //verifyAddress(daviplataContent)
            verifyCellphone(daviplataContent)
            verifyDocument(daviplataContent);
            //verifyCountry(daviplataContent)
            verifyTermAndCondictions(daviplataContent)
            let checked =  daviplataContent.parentElement.querySelector('terms-and-conditions').querySelector('input').checked
            if (checkForErrors(daviplataHelpers) || !checked) {
                removeBlockOverlay();
            } else {
                epayco_submit_daviplata = true;
            }

            return epayco_submit_daviplata;
        }

        function checkForErrors(daviplataHelpers) {
            let hasError = false;

            daviplataHelpers.forEach((item) => {
                let inputHelper = item.querySelector('div');
                if (inputHelper.style.display !== 'none') {
                    hasError = true;
                }
            });

            return hasError;
        }

        function verifyName(daviplataContent) {
            let nameElement = daviplataContent.querySelector('#form-checkout__identificationName-container').querySelector('input');
            if (nameElement.value === '') {
                nameElement.parentElement.classList.add('ep-error');
                let pseHelpers = daviplataContent.parentElement.querySelector('input-helper');
                let child = pseHelpers.querySelector('div');
                child.style.display = 'flex';
            }
        }

        function verifyEmail(daviplataContent) {
            let emailElement = daviplataContent.querySelector('#form-checkout__identificationEmail-container').querySelector('input');
            if (emailElement.value === '') {
                emailElement.parentElement.classList.add('ep-error');
                let pseHelpers = daviplataContent.querySelector('#form-checkout__identificationEmail-container').parentElement.querySelector('input-helper');
                let child = pseHelpers.querySelector('div');
                child.style.display = 'flex';
            }
        }

        function verifyAddress(daviplataContent) {
            let addressElement = daviplataContent.querySelector('#form-checkout__identificationAddress-container').querySelector('input');
            if (addressElement.value === '') {
                addressElement.parentElement.classList.add('ep-error');
                let pseHelpers = daviplataContent.querySelector('#form-checkout__identificationAddress-container').parentElement.querySelector('input-helper');
                let child = pseHelpers.querySelector('div');
                child.style.display = 'flex';
            }
        }

        function verifyCellphone(daviplataContent) {
            let addressElement = daviplataContent.querySelector('#form-checkout__identificationCellphone-container').querySelector('input');
            if (addressElement.value === '') {
                addressElement.parentElement.classList.add("ep-error");
                addressElement.parentElement.parentElement.firstChild.classList.add("ep-error");
                let pseHelpers = daviplataContent.querySelector('#form-checkout__identificationCellphone-container').parentElement.querySelector('input-helper');
                let child = pseHelpers.querySelector('div');
                child.style.display = 'flex';
            }
        }

        function verifyDocument(daviplataContent) {
            let addressElement = daviplataContent.querySelector('#form-checkout__identificationNumber-container').querySelector('input');
            if (addressElement.value === '') {
                addressElement.parentElement.classList.add("ep-error");
                addressElement.parentElement.parentElement.firstChild.classList.add("ep-error");
                let pseHelpers = daviplataContent.querySelector('#form-checkout__identificationNumber-container').parentElement.querySelector('input-helper');
                let child = pseHelpers.querySelector('div');
                child.style.display = 'flex';
            }
        }

        function verifyCountry(daviplataContent) {
            let addressElement = daviplataContent.querySelector('#form-checkout__identificationCountry-container').querySelector('input');
            if (addressElement.value === '') {
                addressElement.parentElement.classList.add("ep-error");
                addressElement.parentElement.parentElement.firstChild.classList.add("ep-error");
                let pseHelpers = daviplataContent.querySelector('#form-checkout__identificationCountry-container').parentElement.querySelector('input-helper');
                let child = pseHelpers.querySelector('div');
                child.style.display = 'flex';
            }
        }


        function removeErrorFromInputTableContainer(daviplataContent) {
            daviplataContent.querySelectorAll('.ep-input-table-label').forEach((item) => {
                item.addEventListener('click', () => {
                    let documentElement = daviplataContent.querySelector('.ep-checkout-daviplata-payment-method');
                    documentElement.querySelector("input-table > div").classList.remove("ep-error")
                    let pseHelpers = documentElement.querySelector('input-helper');
                    let child = pseHelpers.querySelector('div');
                    child.style.display = 'none';
                });
            });
        }

        function verifyTermAndCondictions(daviplataContent) {
            let addressElement = daviplataContent.parentElement.querySelector('terms-and-conditions').querySelector('input');
            if (!addressElement.checked) {
                daviplataContent.parentElement.querySelector('terms-and-conditions > div').classList.add('ep-error')
            }
        }

        // Process when submit the checkout form
        $('form.checkout').on('checkout_place_order_woo-epayco-daviplata', function () {
            return epaycoFormHandlerDaviplata();
        });

        // If payment fail, retry on next checkout page
        $('form#order_review').submit(function () {
            return epaycoFormHandlerDaviplata();
        });

        // Remove Block Overlay from Order Review page
        function removeBlockOverlay() {
            if ($('form#order_review').length > 0) {
                $('.blockOverlay').css('display', 'none');
            }
        }
    });
})(jQuery);
